> # 【虚幻4教程04】UE4零基础入门到独立游戏开发【Landscape地貌篇】
> * https://www.bilibili.com/video/BV1mD4y1D7D6
> * by：CG学习笔记

# 创建地形
## 地形生成
* 基本地形创建界面
  * 分层功能：把地形地貌、道路等不同内容做分层。
    * 创建完后可在细节属性内再更改是否启用
    * 可导入高度图后新建层做叠加，保留基本地形
  * 材质和基本位置、旋转、缩放等参数。
  * 分段大小、每个组件分段类型：影响地形地貌的精细程度，也影响系统资源的消耗程度。
* 也可导入高度图生成地形

## 高度图
* 高度图：提供地形需要的形状和高度。
* UE4中的高度图：`灰度图`，每个像素`16位深度`。`PNG`或`RAW`格式。
  * 可用Houdini、World Machine等工具制作，导出烘焙时选择16bit PNG/RAW16
  * UE4中地形单位：cm，World Machine中：m，所以要*100，不然细节丢失严重

## 测量
* 在`俯视图`中，`选择模式`，`鼠标滚轮`拉选可测量地形大致大小。
  * 测出的数值为cm，除以100后为m。
  * 地形原点是`左上角`。
* 调整长宽：scale参数的x、y调整到接近高度图制作时的长宽尺寸。
* 调整高度：调整Scale.z
  * UE4中`侧视图`测量当前地形高度（cm）。
  * 在World Machine中查看最高最低海拔高度，作差（m）。
  * 差值除以UE4内当前地形高度得到比值，并*100作为Scale.z。

# 地貌管理模式
## 新建
* Landscape Editor 决定当前编辑的地形是哪一块
  * Alpha值决定层之间叠加的强度

## 选择/添加/删除/移动
* 对组件做相应操作。
* 组件属性
  * `强制LOD`：关闭距离剔除优化
* 移动：将地形组件移动到当前正在流送关卡的地形代理中
  * 说人话：对当前关卡创建`子关卡 Levels`，可以在主编辑界面右下把组件移动到相应子关卡中
  * Step 1：选择子关卡
  * Step 2：点击选中的组件
  * `对大型开放世界的优化`：分关卡加载

## 样条
* 创建样条
  * Ctrl加控制点，旋转控制点可调整曲率
  * 工具设定中`使用自动旋转控制点`使拐角平滑
* 连接两曲线
  * Shift选中连接的两端
  * Ctrl添加中控点
* 样条属性：见文档
### 样条常用属性
* 控制点
  * 半宽：调整控制点附近宽度
  * 测衰减：调整附近过渡段范围（在做地形变形时的过渡，0时为断崖效果）
  * 细节中选择所有控制点，并`R`一下，全部变平滑
  * 控制点抬到半空，工具设定中`将地形变形为样条`，让地形凸起到控制点位置（如做下坡）
    * `仅选中`选项根据`选中的分段`做变形
    * 同理，控制点放到底下可以做沟
  * 加网格体，可在控制点处定点放模型
* 分段
  * 地形样条网格体 - 样条网格体添加元素（如做公路等效果）

# 地形造型工具 - 雕刻
## 笔刷
* 雕刻
  * 直接（持续）鼠标左键，升高
  * Shift+鼠标左键，下陷
* 平滑：对高度图、混合层做smooth
  * 丧失雕刻细节
* 平整：做平台场地、工整地形
  * 可选扁平模式：两者、升高、降低、间隔、梯田
  * 斜坡扁平：做斜坡
* 斜坡：选起点终点，添加斜坡
* 侵蚀（风吹日晒痕迹）
  * 阈值：侵蚀效果力度
  * 表面厚度：增加层次感
  * 迭代：侵蚀次数
  * 噪点缩放
* 水力侵蚀（地貌表面沟渠模拟）
  * 设置用于侵蚀的雨水参数等
* 噪点：大范围做高低起伏，然后做平滑，再侵蚀做地貌
* 重拓扑：和平滑配合，尽量不改变地形的基础上，减少棋盘格预览的形变
* 可视性
  * 需要`地形材质`含有`可视性遮罩`
    * 创建材质球 - 细节 - 材质 - 混合模式 - 遮罩
    * 添加节点 `Landscape Visibility Mask` 并接到 `不透明蒙版`
    * 给地形添加该材质
  * 使部分地形不可见，把其它模型镶嵌到不可见处
  * 目标层：针对有多层地形的，设置有效范围
* 镜像：选择对称面，做镜面效果
  * 对称面的箭头方向为正向

## 区域操作
* 选择
  * 选中范围（遮罩）后，可对范围外的部分做雕刻等
  * 在工具设定中可`清除选择`
  * `负遮罩`，选中部分可编辑
* 复制
  * 用选择做一块遮罩，复制工具位置调到遮罩处，工具设定中`匹配`
  * `复制数据到工具`
  * 再把工具位置调到要复制的地方
  * 用雕刻/复制笔刷做微调

## 笔刷参数
* 与工具设定中的对应
* 笔刷形状
  * 循环：圆形笔刷
  * Alpha：白色处有效，黑色处无效，可自定义（给出灰度图）
  * 图案：在整个地形范围中平铺
  * 组件：对整个组件做操作
* 衰减类型：平滑、线性、球形、尖端
* 主界面显示中，内圈笔刷形状，内外圈之间为强度到0的过渡

# 地形造型插件 - Landmass
* 加载插件，新建地形，启用分层
* 地形雕刻栏中出现蓝图笔刷标签，工具设定中选笔刷。或在内容浏览器中Landmass里找相应蓝图笔刷。
## 细节
* 混合模式Blend Mode：对多个笔刷做混合
  * Alpha：叠加，Min：下陷，Max，Additive
* Invert Shape：下陷
* Fall off
  * cap shape：勾选按笔刷形状向上成山，否则向下成谷
  * Falloff angle：笔刷大小
  * [插播小技巧] `ALT+移动点`：移出一个新点
* Effects
  * Curl Noise：在蓝图中通过噪波图实现变形
  * Curl Noise - Curl 1 Strength 数值调大可把单个小山变成群山，单个不超过1
  * Curl Noise - Curl 2 Strength 与1叠加，
  * Curl 1 Tiling 贴图重复次数（针对Curl 1 Strength）
* Smooth Blending 边缘平滑
* Paint Layers 添加材质
  * Step 1：添加元素
  * Step 2：从材质球的Layer Blend中找到层的名字 `Layer <Name>` 填入
  * Step 3：通过Falloff Width和Edge Offset调整覆盖范围
  * Modulation Texture：与噪声图混合使其分布不均匀
  * 这种方式添加材质效果暂时还不是很好，比较粗糙

# 地形材质绘制


# 根据材质权重分配地表植被

# 植物工具

# 置换贴图

# 全局一致纹理（制作地貌裸露岩石）

# 案例 - 

# 
